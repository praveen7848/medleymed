var package = require(__dirname + '/../package.json');
var fs = require('fs');

module.exports = (function ()
{

    // Create return object
    var Glamour = {};

    // Extend function
    function extend(object, extension)
    {
        for (var param in extension) {
            object[param] = extension[param];
        }
    }

    // VERSION
    extend(Glamour, {version: package.version});

    // RUN
    extend(Glamour, {
        run: function (root)
        {
            var glamourFile = root + '/glamour.json';

            if (!fs.existsSync(glamourFile)) {
                console.log("\nCan't find glamour.json\n[ searching for: '" + glamourFile + "' ]");
                return;
            }

            var importList = require('./imports')(
                root,
                require(glamourFile),
                [],
                {npm: [], bower: []}
            );

            fs.writeFileSync(root + '/.glamour.sass', importString(importList, root));

            return root + '/.glamour.sass';
        }
    });

    function importString(importList, root)
    {
        importList = importList.map(function (item)
        {
            var relativePath = (item.substr(0, root.length) == root)
                ? item.substr(root.length + 1)
                : item;
            return '@import ' + relativePath;
        });

        return importList.join('\n');
    }

    // return object
    return Glamour;
})();